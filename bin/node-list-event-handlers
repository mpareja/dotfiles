#!/bin/bash

FILE="$1"

findOn() {
  cat "$FILE" | \
    egrep '\.(on|addEventListener)\('
}

findOff() {
  cat "$FILE" | \
    egrep '\.(off|removeEventListener)\('
}

parseOn() {
  findOn | \
    sed "s/.*\(\.\| \)\([a-zA-Z0-9_]\+\)\.\(addEventListener\|on\)(\([-a-zA-Z0-9_'.]\+\),[ ]\+\([a-zA-Z0-9(.]*\).*/\2 \4 \5 \3/"
}

parseOff() {
  # the following does not include the emitter name
  # sed "s/.*\.\(removeEventListener\|off\)(\([-a-zA-Z0-9_'.]\+\),[ ]\+\([a-zA-Z0-9(.]*\).*/\2 \1 \3/"
  findOff | \
    sed "s/.*\(\.\| \)\([a-zA-Z0-9_]\+\)\.\(removeEventListener\|off\)(\([-a-zA-Z0-9_'.]\+\),[ ]\+\([a-zA-Z0-9(.]*\).*/\2 \4 \5 \3/"
}

parseRemoveAllListeners() {
  cat "$FILE" | \
    egrep "\.removeAllListeners\([a-zA-Z0-9_.']*\)"
}

parse() {
  parseOn
  parseOff
}

parse | sort | column -t -s' '

echo
echo --------------------
echo Remove All Listeners
echo --------------------
parseRemoveAllListeners
echo

echo "COUNTS:"
echo " on: $(findOn | wc -l)"
echo " off: $(findOff | wc -l)"

